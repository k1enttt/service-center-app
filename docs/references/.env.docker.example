# Environment Variables for Docker Deployment
# Copy this file to .env and fill in your values

############################################
# Secrets
# YOU MUST CHANGE THESE BEFORE GOING INTO PRODUCTION
############################################

# Database (generate with: openssl rand -hex 32)
POSTGRES_PASSWORD=your-super-secret-and-long-postgres-password

# JWT Secret (generate with: openssl rand -hex 32)
JWT_SECRET=your-super-secret-jwt-token-with-at-least-32-characters-long

# Supabase Keys (MUST generate from JWT_SECRET using generate-keys.js)
# ⚠️ WARNING: The keys below are PUBLIC DEMO KEYS - DO NOT USE IN PRODUCTION!
# Generate YOUR OWN keys with:
#   node docker/scripts/generate-keys.js "$(grep ^JWT_SECRET .env | cut -d '=' -f2)"
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJhbm9uIiwKICAgICJpc3MiOiAic3VwYWJhc2UtZGVtbyIsCiAgICAiaWF0IjogMTY0MTc2OTIwMCwKICAgICJleHAiOiAxNzk5NTM1NjAwCn0.dc_X5iR_VP_qT0zsiyj_I_OZ2T9FtRU2BBNWN8Bu4GE  # ⚠️ DEMO KEY - MUST REPLACE
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJzZXJ2aWNlX3JvbGUiLAogICAgImlzcyI6ICJzdXBhYmFzZS1kZW1vIiwKICAgICJpYXQiOiAxNjQxNzY5MjAwLAogICAgImV4cCI6IDE3OTk1MzU2MDAKfQ.DaYlNEoUrrEn2Ig7tqibS-PHK5vgusbcbo7X36XVt4Q  # ⚠️ DEMO KEY - MUST REPLACE

# Supabase Infrastructure (all URL-safe hex strings)
DASHBOARD_USERNAME=supabase
DASHBOARD_PASSWORD=change-me-openssl-rand-hex-16
SECRET_KEY_BASE=change-me-openssl-rand-hex-64
VAULT_ENC_KEY=change-me-openssl-rand-hex-32
PG_META_CRYPTO_KEY=change-me-openssl-rand-hex-32

############################################
# Application Settings
############################################

# Setup password for /setup endpoint (generate with: openssl rand -hex 16)
SETUP_PASSWORD=change-this-to-a-secure-password

# Application port (exposed to host) - REQUIRED FOR EACH INSTANCE
# Instance 1: APP_PORT=3025 (auto-derives KONG_PORT=8000)
# Instance 2: APP_PORT=3026 (auto-derives KONG_PORT=8001)
# Instance 3: APP_PORT=3027 (auto-derives KONG_PORT=8002)
APP_PORT=3025

# Kong API Gateway port (exposed to host) - AUTO-CALCULATED
# This port is needed for browser access to Supabase (auth, realtime, storage)
# Auto-calculated as: KONG_PORT = 8000 + (APP_PORT - 3025)
# NOTE: If using setup-instance.sh, this is automatically set
KONG_PORT=8000

############################################
# Database Configuration
############################################

POSTGRES_HOST=db
POSTGRES_DB=postgres
POSTGRES_PORT=5432  # Internal only (not exposed to host)
# default user is postgres

############################################
# Supavisor -- Database pooler
############################################

# Maximum number of PostgreSQL connections Supavisor opens per pool
POOLER_DEFAULT_POOL_SIZE=20
# Maximum number of client connections Supavisor accepts per pool
POOLER_MAX_CLIENT_CONN=100
# Unique tenant identifier
POOLER_TENANT_ID=your-tenant-id
# Pool size for internal metadata storage used by Supavisor
POOLER_DB_POOL_SIZE=5

############################################
# API - Configuration for PostgREST
############################################

PGRST_DB_SCHEMAS=public,storage,graphql_public

############################################
# Auth - Configuration for GoTrue
############################################

## General
# IMPORTANT: Set to your public application URL
# For local: http://localhost:3025 (or 3026, 3027 for other instances)
# For production with Cloudflare Tunnel: https://sv.yourdomain.com
# NOTE: If using setup-instance.sh, configure SITE_URL and this is auto-derived
SITE_URL=http://localhost:3025
ADDITIONAL_REDIRECT_URLS=
JWT_EXPIRY=3600
DISABLE_SIGNUP=false
# API External URL (auto-derived from SITE_URL by setup script)
# For local: http://localhost:3025
# For production: https://sv.yourdomain.com
API_EXTERNAL_URL=http://localhost:3025

## Mailer Config
MAILER_URLPATHS_CONFIRMATION="/auth/v1/verify"
MAILER_URLPATHS_INVITE="/auth/v1/verify"
MAILER_URLPATHS_RECOVERY="/auth/v1/verify"
MAILER_URLPATHS_EMAIL_CHANGE="/auth/v1/verify"

## Email auth
ENABLE_EMAIL_SIGNUP=true
ENABLE_EMAIL_AUTOCONFIRM=false
SMTP_ADMIN_EMAIL=admin@example.com
SMTP_HOST=supabase-mail
SMTP_PORT=2500
SMTP_USER=fake_mail_user
SMTP_PASS=fake_mail_password
SMTP_SENDER_NAME=fake_sender
ENABLE_ANONYMOUS_USERS=false

## Phone auth
ENABLE_PHONE_SIGNUP=true
ENABLE_PHONE_AUTOCONFIRM=true

############################################
# Studio Configuration
############################################

STUDIO_DEFAULT_ORGANIZATION=Default Organization
STUDIO_DEFAULT_PROJECT=Default Project

# Studio port (exposed to host) - REQUIRED FOR EACH INSTANCE
# Instance 1: STUDIO_PORT=3000
# Instance 2: STUDIO_PORT=3100
# Instance 3: STUDIO_PORT=3200
STUDIO_PORT=3000

# Supabase Public URL for Studio (points to Kong Gateway)
# For local: http://localhost:8000 (or 8001, 8002 for other instances)
# For production: https://api.sv.yourdomain.com (via Cloudflare Tunnel)
# NOTE: If using setup-instance.sh, this is auto-derived from SITE_URL
SUPABASE_PUBLIC_URL=http://localhost:8000

# Enable webp support
IMGPROXY_ENABLE_WEBP_DETECTION=true

# Add your OpenAI API key to enable SQL Editor Assistant
OPENAI_API_KEY=

############################################
# Functions - Configuration for Functions
############################################

# NOTE: VERIFY_JWT applies to all functions. Per-function VERIFY_JWT is not supported yet.
FUNCTIONS_VERIFY_JWT=false

############################################
# Logs - Configuration for Analytics
############################################

# Change vector.toml sinks to reflect this change
# these cannot be the same value (generate with: openssl rand -hex 32)
LOGFLARE_PUBLIC_ACCESS_TOKEN=your-super-secret-and-long-logflare-key-public
LOGFLARE_PRIVATE_ACCESS_TOKEN=your-super-secret-and-long-logflare-key-private

# Docker socket location - this value will differ depending on your OS
DOCKER_SOCKET_LOCATION=/var/run/docker.sock

# Google Cloud Project details (optional - for BigQuery analytics)
GOOGLE_PROJECT_ID=GOOGLE_PROJECT_ID
GOOGLE_PROJECT_NUMBER=GOOGLE_PROJECT_NUMBER

############################################
# Next.js Application
############################################

# Internal Supabase URL (for server-side Docker network access)
# This is ONLY for server-side code running inside Docker containers
# Always uses internal Kong service: http://kong:8000
# NOTE: If using setup-instance.sh, this is automatically set
SUPABASE_URL=http://kong:8000

# Public Supabase URL (for client-side browser access)
# For local development: http://localhost:8000 (or 8001, 8002 for other instances)
# For production: https://api.sv.yourdomain.com (via Cloudflare Tunnel)
# ⚠️ IMPORTANT: Browser needs to access this URL, so use localhost or public domain
# NOTE: If using setup-instance.sh, this is auto-derived based on DEPLOYMENT_MODE:
#   - local mode: http://localhost:8000
#   - production mode: https://api.yourdomain.com
NEXT_PUBLIC_SUPABASE_URL=http://localhost:8000

# NOTE: NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY and SUPABASE_SERVICE_ROLE_JWT
# are set in docker-compose.yml from SUPABASE_ANON_KEY and SUPABASE_SERVICE_ROLE_KEY
