# üóÇÔ∏è Proposed Navigation Structure with RBAC Analysis

**Date:** October 26, 2025
**Status:** Proposal for Review

---

## üé® Current Sidebar Design & CSS Documentation

### Layout Architecture

#### Component Hierarchy
```
<SidebarProvider>                    ‚Üí Root context provider
  <AppSidebar variant="inset">       ‚Üí Main sidebar container
    <SidebarHeader>                  ‚Üí Logo & branding
    <SidebarContent>                 ‚Üí Scrollable navigation area
      <NavMain />                    ‚Üí Primary navigation items
      <NavWorkflows />               ‚Üí Collapsible workflow section
      <NavDocuments />               ‚Üí Documents/data section
      <NavSecondary className="mt-auto" /> ‚Üí Bottom links (Settings, Help)
    </SidebarContent>
    <SidebarFooter>                  ‚Üí User profile dropdown
      <NavUser />
    </SidebarFooter>
  </AppSidebar>
  <SidebarInset>                     ‚Üí Main content area
    {children}
  </SidebarInset>
</SidebarProvider>
```

#### CSS Variables & Dimensions
```css
/* From src/app/(auth)/layout.tsx */
--sidebar-width: calc(var(--spacing) * 72);  /* 18rem / 288px desktop */
--header-height: calc(var(--spacing) * 12);  /* 3rem / 48px */

/* From src/components/ui/sidebar.tsx */
SIDEBAR_WIDTH = "16rem"              /* Base width */
SIDEBAR_WIDTH_MOBILE = "18rem"       /* Mobile sheet width */
SIDEBAR_WIDTH_ICON = "3rem"          /* Collapsed icon-only width */

/* Behavior */
collapsible="offcanvas"              /* Slides off-screen on collapse */
variant="inset"                      /* Inset style with border */
```

#### Color Tokens (Light Mode)
```css
/* From src/app/globals.css */
--sidebar: oklch(0.985 0 0);                          /* Near white background */
--sidebar-foreground: oklch(0.141 0.005 285.823);    /* Dark text */
--sidebar-primary: oklch(0.637 0.237 25.331);        /* Orange accent */
--sidebar-primary-foreground: oklch(0.971 0.013 17.38); /* Light text on primary */
--sidebar-accent: oklch(0.967 0.001 286.375);        /* Subtle hover background */
--sidebar-accent-foreground: oklch(0.21 0.006 285.885); /* Hover text */
--sidebar-border: oklch(0.92 0.004 286.32);          /* Separator lines */
--sidebar-ring: oklch(0.637 0.237 25.331);           /* Focus ring */
```

---

### Component-Specific Styling

#### 1. SidebarHeader (Logo Area)
```tsx
<SidebarHeader>
  <SidebarMenu>
    <SidebarMenuItem>
      <SidebarMenuButton
        asChild
        className="data-[slot=sidebar-menu-button]:!p-1.5"
      >
        <a href="/">
          <IconInnerShadowTop className="!size-5" />
          <span className="text-base font-semibold">
            SSTC Service Center
          </span>
        </a>
      </SidebarMenuButton>
    </SidebarMenuItem>
  </SidebarMenu>
</SidebarHeader>
```

**Styling:**
- Padding: `!p-1.5` (6px custom padding override)
- Icon size: `!size-5` (20px √ó 20px)
- Text: `text-base font-semibold` (16px, 600 weight)
- Component: `SidebarMenuButton` with `asChild` pattern

---

#### 2. NavMain (Primary Navigation)
```tsx
<SidebarGroup>
  <SidebarGroupContent className="flex flex-col gap-2">
    {/* Quick Action Button */}
    <SidebarMenu>
      <SidebarMenuItem className="flex items-center gap-2">
        <SidebarMenuButton
          asChild
          tooltip="T·∫°o phi·∫øu nhanh"
          className="bg-primary text-primary-foreground 
                     hover:bg-primary/90 hover:text-primary-foreground 
                     active:bg-primary/90 active:text-primary-foreground 
                     min-w-8 duration-200 ease-linear"
        >
          <a href="/tickets/add">
            <IconCirclePlusFilled />
            <span>T·∫°o phi·∫øu</span>
          </a>
        </SidebarMenuButton>
      </SidebarMenuItem>
    </SidebarMenu>

    {/* Regular Navigation Items */}
    <SidebarMenu>
      {items.map((item) => (
        <SidebarMenuItem key={item.title}>
          <SidebarMenuButton asChild tooltip={item.title}>
            <a href={item.url} className="flex items-center gap-2">
              {item.icon && <item.icon />}
              <span className="flex-1">{item.title}</span>
              {item.badge !== undefined && item.badge !== 0 && (
                <Badge variant="default" className="ml-auto">
                  {item.badge}
                </Badge>
              )}
            </a>
          </SidebarMenuButton>
        </SidebarMenuItem>
      ))}
    </SidebarMenu>
  </SidebarGroupContent>
</SidebarGroup>
```

**Key Features:**
1. **Quick Action Button:**
   - Full primary color background
   - Distinct from other items
   - Transitions: `duration-200 ease-linear`
   - Icon: `IconCirclePlusFilled`

2. **Navigation Items:**
   - Gap between groups: `gap-2` (8px)
   - Layout: `flex items-center gap-2`
   - Title spans full width: `flex-1`
   - Badge auto-positioned: `ml-auto`

3. **Badge Display:**
   - Only shows if `badge !== undefined && badge !== 0`
   - Uses shadcn `Badge` component
   - Variant: `default` (primary color)

4. **Tooltips:**
   - Enabled on all menu buttons
   - Shows on hover for collapsed state

---

#### 3. NavWorkflows (Collapsible Section)
```tsx
<SidebarGroup className="group-data-[collapsible=icon]:hidden">
  <SidebarGroupLabel>Quy tr√¨nh</SidebarGroupLabel>
  <SidebarMenu>
    {items.map((item) => (
      <Collapsible
        key={item.title}
        asChild
        defaultOpen={item.items.some((subItem) => 
          pathname.startsWith(subItem.url)
        )}
        className="group/collapsible"
      >
        <SidebarMenuItem>
          <CollapsibleTrigger asChild>
            <SidebarMenuButton tooltip={item.title}>
              {item.icon && <item.icon />}
              <span>{item.title}</span>
              <IconChevronRight className="ml-auto transition-transform 
                                           duration-200 
                                           group-data-[state=open]/collapsible:rotate-90" />
            </SidebarMenuButton>
          </CollapsibleTrigger>
          <CollapsibleContent>
            <SidebarMenuSub>
              {item.items.map((subItem) => (
                <SidebarMenuSubItem key={subItem.title}>
                  <SidebarMenuSubButton
                    asChild
                    isActive={pathname === subItem.url}
                  >
                    <a href={subItem.url}>
                      <span>{subItem.title}</span>
                    </a>
                  </SidebarMenuSubButton>
                </SidebarMenuSubItem>
              ))}
            </SidebarMenuSub>
          </CollapsibleContent>
        </SidebarMenuItem>
      </Collapsible>
    ))}
  </SidebarMenu>
</SidebarGroup>
```

**Key Features:**
1. **Auto-expand:**
   - `defaultOpen` based on current pathname
   - Checks if any sub-item matches current route

2. **Chevron Animation:**
   - Rotates 90¬∞ when open
   - Smooth transition: `duration-200`
   - Uses group states: `group-data-[state=open]/collapsible:rotate-90`

3. **Active State:**
   - Sub-items use `isActive={pathname === subItem.url}`
   - Automatically styled by SidebarMenuSubButton

4. **Collapse Behavior:**
   - Hidden when sidebar collapses: `group-data-[collapsible=icon]:hidden`

---

#### 4. NavDocuments (Data Section)
```tsx
<SidebarGroup className="group-data-[collapsible=icon]:hidden">
  <SidebarGroupLabel>D·ªØ li·ªáu</SidebarGroupLabel>
  <SidebarMenu>
    {items.map((item) => (
      <SidebarMenuItem key={item.name}>
        <SidebarMenuButton asChild>
          <a href={item.url}>
            <item.icon />
            <span>{item.name}</span>
          </a>
        </SidebarMenuButton>
      </SidebarMenuItem>
    ))}
  </SidebarMenu>
</SidebarGroup>
```

**Key Features:**
1. **Group Label:**
   - Uses `SidebarGroupLabel` component
   - Text: "D·ªØ li·ªáu" (Data)

2. **Simple List:**
   - No collapsible behavior
   - Icon + text layout
   - No badges

3. **Collapse Behavior:**
   - Hidden when sidebar collapses

---

#### 5. NavSecondary (Bottom Links)
```tsx
<SidebarGroup className="mt-auto">
  <SidebarGroupContent>
    <SidebarMenu>
      {items.map((item) => (
        <SidebarMenuItem key={item.title}>
          <SidebarMenuButton asChild>
            <a href={item.url}>
              <item.icon />
              <span>{item.title}</span>
            </a>
          </SidebarMenuButton>
        </SidebarMenuItem>
      ))}
    </SidebarMenu>
  </SidebarGroupContent>
</SidebarGroup>
```

**Key Features:**
1. **Positioning:**
   - `mt-auto` pushes to bottom of SidebarContent
   - Always at bottom before footer

2. **Items:**
   - Settings (placeholder)
   - Help (placeholder)
   - Support link

---

#### 6. NavUser (Footer Profile)
```tsx
<SidebarFooter>
  <SidebarMenu>
    <SidebarMenuItem>
      <DropdownMenu>
        <DropdownMenuTrigger asChild>
          <SidebarMenuButton
            size="lg"
            className="data-[state=open]:bg-sidebar-accent 
                       data-[state=open]:text-sidebar-accent-foreground"
          >
            <Avatar className="h-8 w-8 rounded-lg">
              <AvatarImage src={profile.avatar_url} />
              <AvatarFallback className="rounded-lg">
                {getInitials(profile.full_name)}
              </AvatarFallback>
            </Avatar>
            <div className="grid flex-1 text-left text-sm leading-tight">
              <span className="truncate font-medium">
                {profile.full_name}
              </span>
              <span className="text-muted-foreground truncate text-xs">
                {profile.email}
              </span>
            </div>
            <IconDotsVertical className="ml-auto size-4" />
          </SidebarMenuButton>
        </DropdownMenuTrigger>
        <DropdownMenuContent
          side={isMobile ? "bottom" : "right"}
          align="end"
          sideOffset={4}
        >
          {/* Menu items */}
        </DropdownMenuContent>
      </DropdownMenu>
    </SidebarMenuItem>
  </SidebarMenu>
</SidebarFooter>
```

**Key Features:**
1. **Avatar:**
   - Size: `h-8 w-8` (32px √ó 32px)
   - Rounded: `rounded-lg`
   - Fallback: 2-letter initials

2. **User Info:**
   - Layout: `grid flex-1 text-left`
   - Name: `text-sm font-medium truncate`
   - Email: `text-xs text-muted-foreground truncate`
   - Leading: `leading-tight` for compact spacing

3. **Dropdown:**
   - Large button: `size="lg"`
   - Active state: Custom accent colors
   - Adaptive position: Right on desktop, bottom on mobile
   - Offset: `sideOffset={4}`

4. **Menu Items:**
   - Account link
   - Logout button with `data-testid`

---

### Responsive Behavior

#### Desktop (md and above)
```tsx
<Sidebar
  collapsible="offcanvas"
  variant="inset"
  className="fixed inset-y-0 z-10 hidden h-svh w-(--sidebar-width) 
             transition-[left,right,width] duration-200 ease-linear md:flex"
>
```
- Width: `--sidebar-width` (288px)
- Fixed position: `fixed inset-y-0`
- Z-index: `z-10`
- Hidden on mobile: `hidden md:flex`
- Transitions: `duration-200 ease-linear`

#### Mobile
```tsx
<Sheet open={openMobile}>
  <SheetContent
    side="left"
    className="bg-sidebar text-sidebar-foreground w-(--sidebar-width) p-0"
    style={{ "--sidebar-width": SIDEBAR_WIDTH_MOBILE }}
  >
```
- Width: `18rem` (288px ‚Üí 288px same as desktop)
- Implemented as Sheet (modal overlay)
- Slides from left
- No padding: `p-0`
- Custom width via CSS variable

#### Collapse States
1. **Expanded (default):**
   - Width: `16rem` (256px) or custom `calc(var(--spacing) * 72)`
   - All text visible
   - Groups expanded

2. **Collapsed (icon-only):**
   - Width: `3rem` (48px)
   - Only icons visible
   - Groups with labels hidden: `group-data-[collapsible=icon]:hidden`
   - Tooltips show on hover

3. **Offcanvas (mobile):**
   - Slides off-screen: `left-[calc(var(--sidebar-width)*-1)]`
   - Overlay backdrop
   - Swipe to close

---

### Interaction States

#### Navigation Items
```tsx
// Default state (from sidebar.tsx)
"group/menu-button flex w-full items-center gap-2 overflow-hidden 
 rounded-md p-2 text-left text-sm outline-none 
 ring-sidebar-ring transition-[width,height,padding] 
 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground 
 focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground"

// Active state
"data-[active=true]:bg-sidebar-accent 
 data-[active=true]:text-sidebar-accent-foreground 
 data-[active=true]:font-medium"
```

**States:**
1. **Default:** Transparent background
2. **Hover:** `bg-sidebar-accent` (subtle gray)
3. **Active:** `bg-sidebar-accent` + `font-medium` (bold text)
4. **Focus:** `ring-2 ring-sidebar-ring` (keyboard navigation)
5. **Disabled:** Muted colors, no interaction

#### Quick Action Button (Create Ticket)
```css
bg-primary                        /* Orange background */
text-primary-foreground           /* White text */
hover:bg-primary/90               /* Slightly darker on hover */
active:bg-primary/90              /* Same on active */
min-w-8                           /* Minimum 32px width */
duration-200 ease-linear          /* Smooth transition */
```

---

### Spacing & Typography

#### Gaps & Padding
```tsx
<SidebarGroupContent className="flex flex-col gap-2">  /* 8px between groups */
<SidebarMenuItem className="flex items-center gap-2">  /* 8px icon-text gap */
<SidebarMenuButton className="p-2">                   /* 8px padding */
<SidebarHeader className="!p-1.5">                    /* 6px custom padding */
```

#### Text Sizes
```css
/* Header logo */
text-base font-semibold           /* 16px, 600 weight */

/* Navigation items */
text-sm                           /* 14px */

/* User name */
text-sm font-medium               /* 14px, 500 weight */

/* User email */
text-xs text-muted-foreground     /* 12px, muted */

/* Group labels */
text-xs uppercase                 /* 12px, uppercase */
```

#### Icon Sizes
```css
/* Default icons */
size-4                            /* 16px √ó 16px */

/* Header logo */
!size-5                           /* 20px √ó 20px (override) */

/* User avatar */
h-8 w-8                           /* 32px √ó 32px */

/* Large button icons */
size-5                            /* 20px √ó 20px */
```

---

### Data Flow & State Management

#### Role-Based Filtering
```typescript
// src/components/app-sidebar.tsx
function getFilteredData(userRole: UserRole = "reception") {
  return {
    ...baseData,
    workflows: baseData.workflows.filter((item) =>
      item.allowedRoles.includes(userRole),
    ),
    documents: baseData.documents.filter((item) =>
      item.allowedRoles.includes(userRole),
    ),
  };
}

const data = getFilteredData(userRole);
```

**Process:**
1. Fetch user profile via tRPC
2. Extract role from profile
3. Filter navigation items by `allowedRoles`
4. Render only authorized items

#### Badge Counters
```typescript
// Dynamic badge addition
const navMainWithBadge = data.navMain.map((item) => {
  if (item.url === "/dashboard/service-requests") {
    return { ...item, badge: pendingCount };
  }
  if (item.url === "/dashboard/deliveries") {
    return { ...item, badge: deliveriesCount };
  }
  return item;
});
```

**Sources:**
- Service Requests: `usePendingCount()` hook
- Deliveries: `usePendingDeliveriesCount()` hook
- Real-time updates via tRPC subscriptions

#### Active State Detection
```typescript
const pathname = usePathname();

// In nav components
const handleClick = (e: React.MouseEvent<HTMLAnchorElement>, url: string) => {
  if (pathname === url) {
    e.preventDefault(); // Prevent navigation to same page
  }
};

// For active styling
isActive={pathname === subItem.url}
```

---

### Loading States

#### Sidebar Skeleton
```tsx
{isLoading ? (
  <SidebarSkeleton />
) : (
  <>{/* Normal content */}</>
)}
```

**SidebarSkeleton features:**
- Placeholder for logo
- 5 skeleton menu items
- Animated pulse effect
- Matches sidebar dimensions

#### User Profile Loading
```tsx
if (loading) {
  return (
    <SidebarMenuButton size="lg" disabled>
      <Avatar>
        <AvatarFallback>...</AvatarFallback>
      </Avatar>
      <div className="grid">
        <span>Loading...</span>
        <span className="text-muted-foreground">...</span>
      </div>
    </SidebarMenuButton>
  );
}
```

---

### Icon Library

**Source:** `@tabler/icons-react`

**Current Icons Used:**
```typescript
import {
  IconClipboardList,      // Tickets
  IconComponents,         // Parts
  IconDashboard,         // Dashboard
  IconDevices,           // Products
  IconHelp,              // Help
  IconInnerShadowTop,    // Logo
  IconPhone,             // Support
  IconSettings,          // Settings
  IconUser,              // Customers
  IconUsers,             // Team
  IconChecklist,         // Workflows
  IconBuildingWarehouse, // Warehouses
  IconPackage,           // Inventory
  IconInbox,             // Service Requests
  IconTruckDelivery,     // Deliveries
  IconCirclePlusFilled,  // Quick action
  IconChevronRight,      // Collapsible indicator
  IconDotsVertical,      // User menu
} from "@tabler/icons-react";
```

**Icon Guidelines:**
- Consistent style: Outline style from Tabler
- Size: 16px (size-4) for nav items
- Color: Inherits from parent text color
- Spacing: 8px gap from text

---

### Accessibility Features

#### Keyboard Navigation
```typescript
// Keyboard shortcut: Cmd/Ctrl + B
const SIDEBAR_KEYBOARD_SHORTCUT = "b";

React.useEffect(() => {
  const handleKeyDown = (event: KeyboardEvent) => {
    if (
      event.key === SIDEBAR_KEYBOARD_SHORTCUT &&
      (event.metaKey || event.ctrlKey)
    ) {
      event.preventDefault();
      toggleSidebar();
    }
  };
  // ...
});
```

#### ARIA & Test IDs
```tsx
<SidebarMenuButton
  asChild
  tooltip="T·∫°o phi·∫øu nhanh"           // Accessible tooltip
  data-testid="user-menu-trigger"    // Test automation
>
```

#### Focus Management
```css
focus-visible:ring-2                 /* Keyboard focus indicator */
outline-none                         /* Remove default outline */
ring-sidebar-ring                    /* Custom ring color */
```

---

### Animation & Transitions

#### Sidebar Collapse
```css
transition-[width,height,padding]
duration-200
ease-linear
```

#### Chevron Rotation
```css
transition-transform
duration-200
group-data-[state=open]/collapsible:rotate-90
```

#### Hover Effects
```css
hover:bg-sidebar-accent
hover:text-sidebar-accent-foreground
duration-200
ease-linear
```

---

### Critical Implementation Notes

#### ‚ö†Ô∏è DO NOT CHANGE:
1. **Component hierarchy** - Order matters for styling
2. **CSS variable names** - Used across multiple files
3. **Spacing system** - `gap-2`, `p-2` maintains consistency
4. **Icon sizes** - Calibrated for visual balance
5. **Animation durations** - `duration-200` for smooth feel
6. **Collapse behavior** - `group-data-[collapsible=icon]:hidden` pattern
7. **Mobile Sheet** - Sheet component for mobile overlay

#### ‚úÖ SAFE TO CHANGE:
1. **Navigation item content** - Text, URLs, icons
2. **Role-based filtering logic** - `allowedRoles` arrays
3. **Badge counters** - Add/remove badges as needed
4. **Group labels** - "D·ªØ li·ªáu", "Quy tr√¨nh" can be renamed
5. **Item order** - Reorder items within groups
6. **Add new groups** - Follow existing patterns

#### üîß WHEN REFACTORING:
1. Keep `SidebarGroup` ‚Üí `SidebarMenu` ‚Üí `SidebarMenuItem` hierarchy
2. Preserve `className` patterns for responsive behavior
3. Maintain `asChild` pattern for proper component composition
4. Keep tooltip props for collapsed state
5. Use `handleClick` pattern to prevent duplicate navigation
6. Preserve badge conditional rendering logic
7. Keep loading states and skeletons

---

## üìä Current vs Proposed Structure

### Current Structure (Inconsistent)
```
/dashboard                          ‚Üí Dashboard
/tickets                            ‚Üí Tickets
/dashboard/service-requests         ‚Üí Service Requests
/dashboard/deliveries               ‚Üí Deliveries
/customers                          ‚Üí Customers
/products                           ‚Üí Products
/parts                              ‚Üí Parts
/warehouses                         ‚Üí Warehouses
/dashboard/inventory/products       ‚Üí Physical Products
/dashboard/inventory/stock-levels   ‚Üí Stock Levels
/dashboard/inventory/rma            ‚Üí RMA
/brands                             ‚Üí Brands
/team                               ‚Üí Team
/my-tasks                           ‚Üí My Tasks
/workflows/templates                ‚Üí Templates
/workflows/task-types               ‚Üí Task Types
```

### Proposed Structure (Option 2 - Grouped by Function)
```
üìä OVERVIEW
  /dashboard                        ‚Üí Dashboard & Analytics

üéØ OPERATIONS (Daily Work)
  /operations/tickets               ‚Üí Service Tickets
  /operations/service-requests      ‚Üí Public Service Requests
  /operations/deliveries            ‚Üí Delivery Management
  /operations/my-tasks              ‚Üí My Tasks (Technician)

üì¶ INVENTORY (Stock & Warehouse)
  /inventory/products               ‚Üí Physical Products Tracking
  /inventory/stock-levels           ‚Üí Stock Levels & Alerts
  /inventory/rma                    ‚Üí RMA Management
  /inventory/warehouses             ‚Üí Warehouse Management

üìö CATALOG (Master Data)
  /catalog/products                 ‚Üí Product Catalog/SKU
  /catalog/parts                    ‚Üí Parts Catalog
  /catalog/brands                   ‚Üí Brand Management

üë• MANAGEMENT (Admin Functions)
  /management/customers             ‚Üí Customer Management
  /management/team                  ‚Üí Team & Users

‚öôÔ∏è WORKFLOWS (Templates)
  /workflows/templates              ‚Üí Workflow Templates
  /workflows/task-types             ‚Üí Task Type Definitions

üîß SETTINGS (System Config)
  /settings/system                  ‚Üí System Settings
  /settings/email                   ‚Üí Email Configuration
  /settings/account                 ‚Üí My Account
```

---

## üé≠ RBAC Analysis by Role

### 1Ô∏è‚É£ ADMIN - Full System Access

#### Sidebar Navigation
```
üìä OVERVIEW
  ‚úÖ Dashboard

üéØ OPERATIONS
  ‚úÖ Tickets
  ‚úÖ Service Requests
  ‚úÖ Deliveries
  ‚úÖ My Tasks

üì¶ INVENTORY
  ‚úÖ Physical Products
  ‚úÖ Stock Levels
  ‚úÖ RMA
  ‚úÖ Warehouses

üìö CATALOG
  ‚úÖ Products
  ‚úÖ Parts
  ‚úÖ Brands

üë• MANAGEMENT
  ‚úÖ Customers
  ‚úÖ Team                   [Can create ALL roles, change ANY role]

‚öôÔ∏è WORKFLOWS
  ‚úÖ Templates
  ‚úÖ Task Types

üîß SETTINGS
  ‚úÖ System Settings        [Admin only]
  ‚úÖ Email Configuration
  ‚úÖ Audit Logs            [Admin only]
  ‚úÖ My Account
```

**Total Pages Visible:** 18/18 (100%)

---

### 2Ô∏è‚É£ MANAGER - Oversight & Approval

#### Sidebar Navigation
```
üìä OVERVIEW
  ‚úÖ Dashboard              [View all metrics, revenue, KPIs]

üéØ OPERATIONS
  ‚úÖ Tickets                [View all, assign, change priority]
  ‚úÖ Service Requests       [Convert to tickets]
  ‚úÖ Deliveries             [Monitor delivery status]
  ‚úÖ My Tasks               [View/manage tasks assigned to me]

üì¶ INVENTORY
  ‚úÖ Physical Products      [View tracking, approve movements]
  ‚úÖ Stock Levels           [Monitor stock, set alerts]
  ‚úÖ RMA                    [Create RMA batches, approve returns]
  ‚úÖ Warehouses             [Manage warehouse config]

üìö CATALOG
  ‚úÖ Products               [Full CRUD on product catalog]
  ‚úÖ Parts                  [Full CRUD on parts catalog]
  ‚úÖ Brands                 [Manage brands]

üë• MANAGEMENT
  ‚úÖ Customers              [Full CRUD except delete]
  ‚úÖ Team                   [Can create Tech/Reception only]
                           [Can reset passwords for Tech/Reception]
                           [Can change roles: Tech ‚Üî Reception only]
                           [CANNOT create/edit Admin or Manager]

‚öôÔ∏è WORKFLOWS
  ‚úÖ Templates              [Create/modify workflows]
  ‚úÖ Task Types             [Define task types]

üîß SETTINGS
  ‚ùå System Settings        [Admin only]
  ‚úÖ Email Configuration    [Configure templates]
  ‚ùå Audit Logs            [Admin only]
  ‚úÖ My Account
```

**Total Pages Visible:** 16/18 (89%)
**Restrictions:**
- Cannot access System Settings
- Cannot access Audit Logs
- Team page: Limited to Tech/Reception management

---

### 3Ô∏è‚É£ TECHNICIAN - Task Execution

#### Sidebar Navigation
```
üìä OVERVIEW
  ‚ùå Dashboard              [No analytics access]

üéØ OPERATIONS
  ‚úÖ Tickets                [View ONLY assigned tickets]
                           [Read-only ticket info]
                           [Can add comments to own tickets]
  ‚ùå Service Requests       [No access]
  ‚ùå Deliveries            [No access]
  ‚úÖ My Tasks              ‚≠ê [PRIMARY PAGE - Default redirect]
                           [View/update own tasks]
                           [Upload photos, notes]
                           [Request parts]

üì¶ INVENTORY
  ‚úÖ Physical Products      [Read-only: Serial verification]
  ‚úÖ Stock Levels           [Read-only: Check availability]
  ‚ùå RMA                    [No access]
  ‚ùå Warehouses            [No access]

üìö CATALOG
  ‚úÖ Products               [Read-only: Warranty check, specs]
  ‚úÖ Parts                  [Read-only: Search parts info]
  ‚úÖ Brands                 [Read-only: View brands]

üë• MANAGEMENT
  ‚ùå Customers              [View only for assigned tickets]
  ‚ùå Team                   [No access]

‚öôÔ∏è WORKFLOWS
  ‚ùå Templates              [No access]
  ‚ùå Task Types             [No access]

üîß SETTINGS
  ‚ùå System Settings
  ‚ùå Email Configuration
  ‚ùå Audit Logs
  ‚úÖ My Account            [Can update own profile only]
```

**Total Pages Visible:** 7/18 (39%)
**Primary Focus:** My Tasks page
**UI Simplifications:**
- Hide pricing/cost fields
- Simplified navigation
- Task-focused dashboard
- Quick serial verification tool

---

### 4Ô∏è‚É£ RECEPTION - Customer Intake

#### Sidebar Navigation
```
üìä OVERVIEW
  ‚ùå Dashboard              [No analytics access]

üéØ OPERATIONS
  ‚úÖ Tickets                [View all tickets]
                           [Create new tickets]
                           [Update customer info]
                           [CANNOT assign techs or change status]
  ‚úÖ Service Requests       ‚≠ê [Convert public requests to tickets]
  ‚úÖ Deliveries             ‚≠ê [Mark ready, confirm pickup/delivery]
  ‚ùå My Tasks               [Not applicable]

üì¶ INVENTORY
  ‚ùå Physical Products      [No access]
  ‚ùå Stock Levels           [No access]
  ‚ùå RMA                    [No access]
  ‚ùå Warehouses            [No access]

üìö CATALOG
  ‚úÖ Products               [Read-only: Warranty check by serial]
  ‚ùå Parts                  [No access]
  ‚úÖ Brands                 [Read-only: View brands]

üë• MANAGEMENT
  ‚úÖ Customers              ‚≠ê [Full CRUD except delete]
                           [Primary focus: Customer search/create]
  ‚ùå Team                   [No access]

‚öôÔ∏è WORKFLOWS
  ‚ùå Templates              [No access - but can SELECT during ticket creation]
  ‚ùå Task Types             [No access]

üîß SETTINGS
  ‚ùå System Settings
  ‚ùå Email Configuration
  ‚ùå Audit Logs
  ‚úÖ My Account
```

**Total Pages Visible:** 6/18 (33%)
**Primary Focus:** Customer intake, ticket creation, delivery confirmation
**UI Simplifications:**
- Large search bar for customers
- Recent tickets board
- Simplified ticket form
- No technical task details

---

## üìã Navigation Groups in Sidebar

### Proposed Sidebar Structure

```typescript
// src/components/app-sidebar.tsx

const navigationGroups = [
  {
    id: 'overview',
    title: 'T·ªïng quan',
    allowedRoles: ['admin', 'manager', 'technician'],
    items: [
      { title: 'Dashboard', url: '/dashboard', icon: IconDashboard },
      {
        title: 'C√¥ng vi·ªác c·ªßa t√¥i',
        url: '/my-tasks',
        icon: IconChecklist,
        allowedRoles: ['admin', 'manager', 'technician']
      }
    ]
  },
  {
    id: 'operations',
    title: 'V·∫≠n h√†nh',
    items: [
      {
        title: 'Phi·∫øu d·ªãch v·ª•',
        url: '/operations/tickets',
        icon: IconClipboardList,
        allowedRoles: ['admin', 'manager', 'technician', 'reception']
      },
      {
        title: 'Y√™u c·∫ßu d·ªãch v·ª•',
        url: '/operations/service-requests',
        icon: IconInbox,
        allowedRoles: ['admin', 'manager', 'reception'],
        badge: 'pendingServiceRequests' // Dynamic counter
      }
    ]
  },
  {
    id: 'inventory',
    title: 'Kho h√†ng',
    items: [
      {
        title: 'S·∫£n ph·∫©m v·∫≠t l√Ω',
        url: '/inventory/products',
        icon: IconPackage,
        allowedRoles: ['admin', 'manager', 'technician'],
        readOnly: ['technician']
      },
      {
        title: 'M·ª©c t·ªìn kho',
        url: '/inventory/stock-levels',
        icon: IconChartBar,
        allowedRoles: ['admin', 'manager', 'technician'],
        readOnly: ['technician']
      },
      {
        title: 'Qu·∫£n l√Ω RMA',
        url: '/inventory/rma',
        icon: IconRefresh,
        allowedRoles: ['admin', 'manager']
      },
      {
        title: 'Qu·∫£n l√Ω kho',
        url: '/inventory/warehouses',
        icon: IconBuildingWarehouse,
        allowedRoles: ['admin', 'manager']
      }
    ]
  },
  {
    id: 'catalog',
    title: 'Danh m·ª•c',
    items: [
      {
        title: 'S·∫£n ph·∫©m',
        url: '/catalog/products',
        icon: IconDevices,
        allowedRoles: ['admin', 'manager', 'technician', 'reception'],
        readOnly: ['technician', 'reception']
      },
      {
        title: 'Linh ki·ªán',
        url: '/catalog/parts',
        icon: IconComponents,
        allowedRoles: ['admin', 'manager', 'technician'],
        readOnly: ['technician']
      },
      {
        title: 'Nh√£n h√†ng',
        url: '/catalog/brands',
        icon: IconTag,
        allowedRoles: ['admin', 'manager', 'technician', 'reception'],
        readOnly: ['technician', 'reception']
      }
    ]
  },
  {
    id: 'management',
    title: 'Qu·∫£n l√Ω',
    items: [
      {
        title: 'Kh√°ch h√†ng',
        url: '/management/customers',
        icon: IconUser,
        allowedRoles: ['admin', 'manager', 'reception']
      },
      {
        title: 'Nh√¢n s·ª±',
        url: '/management/team',
        icon: IconUsers,
        allowedRoles: ['admin', 'manager']
      }
    ]
  },
  {
    id: 'workflows',
    title: 'Quy tr√¨nh',
    allowedRoles: ['admin', 'manager'],
    items: [
      {
        title: 'M·∫´u c√¥ng vi·ªác',
        url: '/workflows/templates',
        icon: IconTemplate
      },
      {
        title: 'Lo·∫°i c√¥ng vi·ªác',
        url: '/workflows/task-types',
        icon: IconListCheck
      }
    ]
  },
  {
    id: 'settings',
    title: 'C√†i ƒë·∫∑t',
    items: [
      {
        title: 'H·ªá th·ªëng',
        url: '/settings/system',
        icon: IconSettings,
        allowedRoles: ['admin']
      },
      {
        title: 'Email',
        url: '/settings/email',
        icon: IconMail,
        allowedRoles: ['admin', 'manager']
      },
      {
        title: 'T√†i kho·∫£n',
        url: '/settings/account',
        icon: IconUserCircle,
        allowedRoles: ['admin', 'manager', 'technician', 'reception']
      }
    ]
  }
];
```

---

## üîÑ Migration Plan

### Phase 1: Create New Structure (No Breaking Changes)
```bash
# Create new directory structure
mkdir -p src/app/(auth)/operations/{tickets,service-requests,deliveries,my-tasks}
mkdir -p src/app/(auth)/inventory/{products,stock-levels,rma,warehouses}
mkdir -p src/app/(auth)/catalog/{products,parts,brands}
mkdir -p src/app/(auth)/management/{customers,team}
mkdir -p src/app/(auth)/settings/{system,email,account}
```

### Phase 2: Move Files
```bash
# Operations
mv src/app/(auth)/tickets ‚Üí src/app/(auth)/operations/tickets
mv src/app/(auth)/dashboard/service-requests ‚Üí src/app/(auth)/operations/service-requests
mv src/app/(auth)/dashboard/deliveries ‚Üí src/app/(auth)/operations/deliveries
mv src/app/(auth)/my-tasks ‚Üí src/app/(auth)/operations/my-tasks

# Inventory
mv src/app/(auth)/dashboard/inventory/products ‚Üí src/app/(auth)/inventory/products
mv src/app/(auth)/dashboard/inventory/stock-levels ‚Üí src/app/(auth)/inventory/stock-levels
mv src/app/(auth)/dashboard/inventory/rma ‚Üí src/app/(auth)/inventory/rma
mv src/app/(auth)/warehouses ‚Üí src/app/(auth)/inventory/warehouses

# Catalog
mv src/app/(auth)/products ‚Üí src/app/(auth)/catalog/products
mv src/app/(auth)/parts ‚Üí src/app/(auth)/catalog/parts
mv src/app/(auth)/brands ‚Üí src/app/(auth)/catalog/brands

# Management
mv src/app/(auth)/customers ‚Üí src/app/(auth)/management/customers
mv src/app/(auth)/team ‚Üí src/app/(auth)/management/team
```

### Phase 3: Update Sidebar Navigation
- Update `src/components/app-sidebar.tsx` with new structure
- Add proper role filtering per section
- Update URL paths

### Phase 4: Add Redirects (Backwards Compatibility)
```typescript
// src/middleware.ts
const redirects = {
  '/tickets': '/operations/tickets',
  '/customers': '/management/customers',
  '/products': '/catalog/products',
  '/parts': '/catalog/parts',
  '/warehouses': '/inventory/warehouses',
  // ... etc
};
```

### Phase 5: Update Internal Links
- Search codebase for hardcoded URLs
- Update Link components
- Update tRPC router paths if needed

---

## ‚úÖ Benefits of Proposed Structure

### 1. **Clear Mental Model**
- Operations = Daily work
- Inventory = Stock management
- Catalog = Master data
- Management = Admin functions
- Workflows = Process templates
- Settings = Configuration

### 2. **Easier RBAC**
- Groups align with permissions
- Clear visual separation in sidebar
- Easy to understand access levels

### 3. **Scalability**
- Easy to add new pages to logical groups
- Clear hierarchy for future features
- Consistent naming patterns

### 4. **Better UX per Role**

**Manager sees:**
```
üìä Dashboard
üéØ Operations (4 items)
  - Phi·∫øu d·ªãch v·ª•
  - Y√™u c·∫ßu d·ªãch v·ª•
  - Giao h√†ng
  - C√¥ng vi·ªác c·ªßa t√¥i ‚≠ê
üì¶ Inventory (4 items)
üìö Catalog (3 items)
üë• Management (2 items)
‚öôÔ∏è Workflows (2 items)
üîß Settings (2 items)
```
  - C√¥ng vi·ªác c·ªßa t√¥i ‚≠ê
üì¶ Inventory (4 items)
üìö Catalog (3 items)
üë• Management (2 items)
‚öôÔ∏è Workflows (2 items)
üîß Settings (2 items)
```

**Technician sees:**
```
üéØ Operations
  - C√¥ng vi·ªác c·ªßa t√¥i ‚≠ê
  - Phi·∫øu d·ªãch v·ª•
üì¶ Inventory (read-only)
  - S·∫£n ph·∫©m v·∫≠t l√Ω
  - M·ª©c t·ªìn kho
üìö Catalog (read-only)
  - S·∫£n ph·∫©m
  - Linh ki·ªán
  - Nh√£n h√†ng
üîß Settings
  - T√†i kho·∫£n
```

**Reception sees:**
```
üéØ Operations
  - Phi·∫øu d·ªãch v·ª•
  - Y√™u c·∫ßu d·ªãch v·ª•
  - Giao h√†ng
üìö Catalog (read-only)
  - S·∫£n ph·∫©m (warranty check)
  - Nh√£n h√†ng
üë• Qu·∫£n l√Ω
  - Kh√°ch h√†ng ‚≠ê
üîß Settings
  - T√†i kho·∫£n
```

---

## ‚ö†Ô∏è Potential Issues & Solutions

### Issue 1: Too Many Sidebar Groups
**Problem:** 6 groups might be overwhelming
**Solution:** Use collapsible sections, remember user preferences

### Issue 2: Breaking Changes for Existing Users
**Problem:** URLs change, bookmarks break
**Solution:** Keep redirects for 6+ months, show notification about new structure

### Issue 3: Confusion Between catalog/products vs inventory/products
**Problem:** Two "products" pages
**Solution:** Rename clearly:
- `/catalog/products` ‚Üí "Danh m·ª•c s·∫£n ph·∫©m" (Product Catalog/SKU)
- `/inventory/products` ‚Üí "S·∫£n ph·∫©m v·∫≠t l√Ω" (Physical Products/Serial Tracking)

### Issue 4: Team Page Access for Manager
**Problem:** Manager can only manage Tech/Reception, not other Managers
**Solution:** 
- Show all users in table
- Disable edit buttons for Admin/Manager roles
- Add tooltip: "Ch·ªâ Admin m·ªõi c√≥ th·ªÉ ch·ªânh s·ª≠a Manager"

---

## üéØ Recommendation

**PROCEED with Option 2** because:

1. ‚úÖ **RBAC-friendly:** Groups align perfectly with permission levels
2. ‚úÖ **Clear hierarchy:** Easy to understand what each section does
3. ‚úÖ **Scalable:** Can add new features to logical groups
4. ‚úÖ **Role-specific UX:** Each role sees relevant sections only
5. ‚úÖ **Better organization:** No more `/dashboard/inventory/products` confusion

**Next Steps:**
1. Review this proposal
2. Confirm group names and icons
3. Start Phase 1: Create new structure without breaking existing
4. Test with all 4 roles
5. Deploy with redirects for backwards compatibility

---

**Questions for Review:**
1. Do the Vietnamese translations make sense?
2. Should we rename "Catalog" to something else? (Danh m·ª•c vs Kho?)
3. Any concerns about the Team page for Manager role?
4. Should Technician see simplified sidebar (fewer groups)?
